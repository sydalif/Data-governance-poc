<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Governance Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 20px auto;
      background: #f4f7fa;
      padding: 20px;
    }

    h1 {
      color: #003366;
      text-align: center;
    }

    form {
      background: #fff;
      padding: 25px 30px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .question {
      margin-bottom: 25px;
    }

    .question h3 {
      margin-bottom: 10px;
      color: #004080;
    }

    label {
      display: block;
      margin-bottom: 6px;
      cursor: pointer;
    }

    button {
      background-color: #003366;
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
      margin: 20px auto;
      display: block;
    }

    .result {
      background-color: #eef2f7;
      border-left: 5px solid #003366;
      padding: 10px 15px;
      margin-top: 10px;
      border-radius: 4px;
    }

    .incorrect {
      border-left-color: #cc0000;
      background-color: #fce9e9;
    }

    #certificate {
      display: none;
      margin-top: 30px;
      background: #fff;
      border: 2px solid #003366;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    #retakeBtn:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    #reviewLinks {
      display: none;
      background: #fff5e6;
      border-left: 4px solid #ff9900;
      padding: 15px;
      margin-top: 20px;
    }

    a.review-topic {
      display: block;
      color: #003366;
      margin: 6px 0;
      text-decoration: underline;
    }
  </style>
</head>
<body>

<h1>Annual Data Governance Quiz</h1>

<form id="quizForm">
  <div id="questionsContainer">
    <!-- Example question -->
    <div class="question" data-topic="Data Governance" id="q1">
      <h3>1. What is the purpose of data governance?</h3>
      <label><input type="radio" name="q1" value="a"> To manage data via policies and responsibilities</label>
      <label><input type="radio" name="q1" value="b"> To store as much data as possible</label>
      <label><input type="radio" name="q1" value="c"> To allow unrestricted access</label>
    </div>

    <div class="question" data-topic="Data Quality" id="q2">
      <h3>2. Which of these are data quality dimensions? (Select all that apply)</h3>
      <label><input type="checkbox" name="q2" value="accuracy"> Accuracy</label>
      <label><input type="checkbox" name="q2" value="timeliness"> Timeliness</label>
      <label><input type="checkbox" name="q2" value="reliability"> Reliability</label>
      <label><input type="checkbox" name="q2" value="confusion"> Confusion</label>
    </div>

    <div class="question" data-topic="Data Protection" id="q3">
      <h3>3. What does data protection focus on?</h3>
      <label><input type="radio" name="q3" value="a"> Data visualization</label>
      <label><input type="radio" name="q3" value="b"> Privacy and security</label>
      <label><input type="radio" name="q3" value="c"> Hardware maintenance</label>
    </div>

    <!-- Add more base questions as needed -->
  </div>

  <button type="submit">Submit</button>
</form>

<div id="reviewLinks"></div>

<button id="retakeBtn" onclick="location.reload()" disabled>Retake Quiz</button>

<div id="certificate">
  <h2>Annual Data Governance Training Acknowledgement</h2>
  <p>This certifies that <strong id="certName">Staff Member</strong> has successfully passed the annual data governance training.</p>
  <p>Date: <strong id="certDate"></strong></p>
  <p>Agency: <strong>Business Registration Authority of Singapore</strong></p>
</div>

<script>
  const correctAnswers = {
    q1: "a",
    q2: ["accuracy", "timeliness", "reliability"],
    q3: "b"
  };

  const followUpQuestions = {
    "Data Governance": {
      id: "dg_followup",
      html: `
        <div class="question" data-topic="Data Governance" id="dg_followup">
          <h3>Follow-up: What framework does DAMA advocate for data governance?</h3>
          <label><input type="radio" name="dg_followup" value="a"> DAMA-DMBOK</label>
          <label><input type="radio" name="dg_followup" value="b"> ISO 9001</label>
          <label><input type="radio" name="dg_followup" value="c"> Agile</label>
        </div>`
    }
  };

  let reviewedTopics = new Set();
  let requiredTopics = new Set();

  // Prompt login name once
  let username = localStorage.getItem("username");
  if (!username) {
    username = prompt("Enter your name for certificate:");
    if (username) localStorage.setItem("username", username);
  }

  document.getElementById("quizForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const form = e.target;
    const questions = form.querySelectorAll(".question");
    let allCorrect = true;
    const addedFollowUps = new Set();
    requiredTopics.clear();
    reviewedTopics.clear();

    questions.forEach(q => {
      const name = q.querySelector("input").name;
      const topic = q.dataset.topic;
      const selected = [...q.querySelectorAll("input:checked")].map(i => i.value);
      const correct = correctAnswers[name];
      let isCorrect = false;

      if (Array.isArray(correct)) {
        isCorrect = selected.sort().toString() === correct.sort().toString();
      } else {
        isCorrect = selected[0] === correct;
      }

      let result = q.querySelector(".result");
      if (!result) {
        result = document.createElement("div");
        result.className = "result";
        q.appendChild(result);
      }

      if (isCorrect) {
        result.textContent = "Correct";
        result.classList.remove("incorrect");
      } else {
        result.textContent = "Incorrect";
        result.classList.add("incorrect");
        allCorrect = false;

        requiredTopics.add(topic);

        if (followUpQuestions[topic] && !addedFollowUps.has(topic)) {
          const temp = document.createElement("div");
          temp.innerHTML = followUpQuestions[topic].html;
          q.insertAdjacentElement("afterend", temp.firstElementChild);
          addedFollowUps.add(topic);
        }
      }
    });

    if (allCorrect) {
      document.getElementById("certificate").style.display = "block";
      document.getElementById("certDate").textContent = new Date().toLocaleDateString();
      document.getElementById("certName").textContent = username || "Staff Member";
      document.getElementById("retakeBtn").style.display = "none";
      document.getElementById("reviewLinks").style.display = "none";
    } else {
      showReviewTopics([...requiredTopics]);
    }
  });

  function showReviewTopics(topics) {
    const container = document.getElementById("reviewLinks");
    container.innerHTML = `<h3>Please review the following topics before retaking:</h3>`;
    topics.forEach(topic => {
      const link = document.createElement("a");
      link.href = `governance.html#${topic.replace(/\s/g, '')}`;
      link.target = "_blank";
      link.className = "review-topic";
      link.textContent = topic;
      link.addEventListener("click", () => {
        reviewedTopics.add(topic);
        checkReviewComplete();
      });
      container.appendChild(link);
    });
    container.style.display = "block";
  }

  function checkReviewComplete() {
    const btn = document.getElementById("retakeBtn");
    if ([...requiredTopics].every(t => reviewedTopics.has(t))) {
      btn.disabled = false;
    }
  }
</script>

</body>
</html>
