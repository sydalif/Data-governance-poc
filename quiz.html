<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Governance Quiz</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 20px auto;
      background: #f8f9fa;
      padding: 20px;
      color: #1a1a1a;
    }

    h1 {
      color: #003366;
      text-align: center;
      margin-bottom: 1.5em;
    }

    form {
      background: #fff;
      padding: 25px 30px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .question {
      margin-bottom: 25px;
    }

    .question h3 {
      margin-bottom: 10px;
      color: #004080;
    }

    label {
      display: block;
      margin-bottom: 6px;
      cursor: pointer;
    }

    input[type="checkbox"], input[type="radio"] {
      margin-right: 8px;
    }

    button {
      background-color: #003366;
      color: white;
      border: none;
      padding: 14px 30px;
      font-size: 1.1rem;
      border-radius: 5px;
      cursor: pointer;
      margin: 20px auto;
      display: block;
      width: 200px;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #002244;
    }

    .result {
      background: #e9f0f7;
      border-left: 5px solid #003366;
      padding: 15px 20px;
      margin-top: 15px;
      border-radius: 4px;
    }

    .incorrect {
      border-left-color: #cc0000;
      background: #f9d6d5;
    }

    .highlight-incorrect {
      color: #cc0000;
      font-weight: bold;
      margin-top: 8px;
    }

    .review-link {
      margin-top: 5px;
      font-size: 0.9rem;
    }

    .review-link a {
      color: #003366;
      text-decoration: underline;
    }

    #certificate {
      display: none;
      margin-top: 30px;
      padding: 25px;
      background-color: #ffffff;
      border: 2px solid #003366;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
    }

    #certificate h2 {
      color: #003366;
      margin-bottom: 20px;
    }

    #certificate p {
      font-size: 1.1rem;
      margin: 10px 0;
    }

    #retakeBtn {
      display: none;
      background-color: #990000;
    }

    #retakeBtn:hover {
      background-color: #770000;
    }
  </style>
</head>
<body>

<h1>Annual Data Governance Quiz</h1>

<form id="quizForm">

  <div id="questionsContainer">

    <div class="question" data-topic="Data Governance">
      <h3>1. What is the purpose of data governance?</h3>
      <label><input type="radio" name="q1" value="a" /> To manage data via policies and responsibilities</label>
      <label><input type="radio" name="q1" value="b" /> To store as much data as possible</label>
      <label><input type="radio" name="q1" value="c" /> To allow unrestricted access</label>
    </div>

    <div class="question" data-topic="Data Quality">
      <h3>2. Which of these are key data quality dimensions? (Select all that apply)</h3>
      <label><input type="checkbox" name="q2" value="accuracy" /> Accuracy</label>
      <label><input type="checkbox" name="q2" value="completeness" /> Completeness</label>
      <label><input type="checkbox" name="q2" value="timeliness" /> Timeliness</label>
      <label><input type="checkbox" name="q2" value="irrelevance" /> Irrelevance</label>
    </div>

    <div class="question" data-topic="Data Protection">
      <h3>3. What does data protection primarily focus on?</h3>
      <label><input type="radio" name="q3" value="a" /> Data analysis</label>
      <label><input type="radio" name="q3" value="b" /> Privacy and security</label>
      <label><input type="radio" name="q3" value="c" /> Data storage capacity</label>
    </div>

    <div class="question" data-topic="Data Access">
      <h3>4. Who should have access to sensitive data?</h3>
      <label><input type="radio" name="q4" value="a" /> Everyone in the agency</label>
      <label><input type="radio" name="q4" value="b" /> Only authorized personnel</label>
      <label><input type="radio" name="q4" value="c" /> External partners</label>
    </div>

    <div class="question" data-topic="Data Governance">
      <h3>5. Which of the following are responsibilities of staff for data governance? (Select all that apply)</h3>
      <label><input type="checkbox" name="q5" value="follow_procedures" /> Follow procedures</label>
      <label><input type="checkbox" name="q5" value="report_issues" /> Report data issues</label>
      <label><input type="checkbox" name="q5" value="training" /> Attend data governance training</label>
      <label><input type="checkbox" name="q5" value="ignore_policies" /> Ignore policies</label>
    </div>

    <div class="question" data-topic="Data Exploitation">
      <h3>6. What is data exploitation?</h3>
      <label><input type="radio" name="q6" value="a" /> Deleting old data</label>
      <label><input type="radio" name="q6" value="b" /> Using data to derive insights and value</label>
      <label><input type="radio" name="q6" value="c" /> Storing data securely</label>
    </div>

    <div class="question" data-topic="Data Fusion">
      <h3>7. What is data fusion?</h3>
      <label><input type="radio" name="q7" value="a" /> Separating datasets</label>
      <label><input type="radio" name="q7" value="b" /> Combining data from multiple sources</label>
      <label><input type="radio" name="q7" value="c" /> Deleting duplicate data</label>
    </div>

    <div class="question" data-topic="Data Access">
      <h3>8. What is a key principle for data access?</h3>
      <label><input type="radio" name="q8" value="a" /> Unlimited access</label>
      <label><input type="radio" name="q8" value="b" /> Role-based access control</label>
      <label><input type="radio" name="q8" value="c" /> Public availability</label>
    </div>

    <div class="question" data-topic="Data Quality">
      <h3>9. Which data quality issue can affect decision making?</h3>
      <label><input type="radio" name="q9" value="a" /> Inaccurate data</label>
      <label><input type="radio" name="q9" value="b" /> Extra storage</label>
      <label><input type="radio" name="q9" value="c" /> Too much data</label>
    </div>

    <div class="question" data-topic="Data Governance">
      <h3>10. What could be a cause of poor data governance? (Select all that apply)</h3>
      <label><input type="checkbox" name="q10" value="weak_controls" /> Weak controls</label>
      <label><input type="checkbox" name="q10" value="ignored_training" /> Ignored training</label>
      <label><input type="checkbox" name="q10" value="unreported_issues" /> Unreported issues</label>
      <label><input type="checkbox" name="q10" value="strong_leadership" /> Strong leadership</label>
    </div>

  </div>

  <button type="submit">Submit</button>
</form>

<button id="retakeBtn" onclick="resetQuiz()">Retake Quiz</button>

<div id="certificate">
  <h2>Annual Data Governance Training Acknowledgement</h2>
  <p>This is to acknowledge that <strong id="certName"></strong> has successfully completed the annual data governance training.</p>
  <p>Date of completion: <strong id="certDate"></strong></p>
  <p>Agency: <strong>Business Registration Authority of Singapore</strong></p>
</div>

<script>
  const correctAnswers = {
    q1: "a",
    q2: ["accuracy", "completeness", "timeliness"],
    q3: "b",
    q4: "b",
    q5: ["follow_procedures", "report_issues", "training"],
    q6: "b",
    q7: "b",
    q8: "b",
    q9: "a",
    q10: ["weak_controls", "ignored_training", "unreported_issues"]
  };

  // Shuffle helper function
  function shuffleArray(array) {
    for(let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  // Randomize questions order inside #questionsContainer
  function shuffleQuestions() {
    const container = document.getElementById('questionsContainer');
    const questions = Array.from(container.children);
    shuffleArray(questions);
    // Remove all questions and re-append in shuffled order
    container.innerHTML = '';
    questions.forEach(q => container.appendChild(q));
  }

  function arraysEqual(a, b) {
    return a.length === b.length && a.every(val => b.includes(val));
  }

  document.getElementById("quizForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const form = e.target;
    const questions = form.querySelectorAll(".question");
    let allCorrect = true;

    questions.forEach((q, idx) => {
      const qid = "q" + (idx + 1);
      const selected = [...q.querySelectorAll("input:checked")].map(i => i.value);
      const answer = correctAnswers[qid];

      let correct = false;
      if (Array.isArray(answer)) {
        correct = arraysEqual(selected.sort(), answer.sort());
      } else {
        correct = selected[0] === answer;
      }

      let result = q.querySelector(".result");
      if (!result) {
        result = document.createElement("div");
        result.className = "result";
        q.appendChild(result);
      }

      if (correct) {
        result.textContent = "Correct";
        result.classList.remove("incorrect");
      } else {
        allCorrect = false;
        result.innerHTML = `<strong class="highlight-incorrect">Incorrect</strong><div class="review-link">Review: <a href="governance.html#${q.dataset.topic.replace(/\s/g, '')}">${q.dataset.topic}</a></div>`;
        result.classList.add("incorrect");
      }
    });

    if (allCorrect) {
      document.getElementById("certificate").style.display = "block";
      document.getElementById("certName").textContent = localStorage.getItem("username") || "Staff Member";
      document.getElementById("certDate").textContent = new Date().toLocaleDateString();
      document.getElementById("retakeBtn").style.display = "none";
    } else {
      alert("You must answer all questions correctly to pass. Review the highlighted topics and try again.");
      document.getElementById("retakeBtn").style.display = "block";
    }
  });

  function resetQuiz() {
    const form = document.getElementById("quizForm");
    form.reset();

    form.querySelectorAll(".result").forEach(r => r.remove());

    document.getElementById("certificate").style.display = "none";
    document.getElementById("retakeBtn").style.display = "none";

    shuffleQuestions();

    window.scrollTo(0, 0);
  }

  // Shuffle questions on initial page load
  window.onload = () => {
    shuffleQuestions();
  };
</script>

</body>
</html>
