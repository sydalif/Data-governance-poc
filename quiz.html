<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Governance Quiz</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 20px auto;
      background: #f8f9fa;
      padding: 20px;
      color: #1a1a1a;
    }
    h1 {
      color: #003366;
      text-align: center;
      margin-bottom: 1.5em;
    }
    form {
      background: #fff;
      padding: 25px 30px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .question {
      margin-bottom: 25px;
    }
    .question h3 {
      margin-bottom: 10px;
      color: #004080;
    }
    label {
      display: block;
      margin-bottom: 6px;
      cursor: pointer;
    }
    input[type="checkbox"], input[type="radio"] {
      margin-right: 8px;
    }
    button {
      background-color: #003366;
      color: white;
      border: none;
      padding: 14px 30px;
      font-size: 1.1rem;
      border-radius: 5px;
      cursor: pointer;
      margin: 20px auto;
      display: block;
      width: 200px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #002244;
    }
    .result {
      background: #e9f0f7;
      border-left: 5px solid #003366;
      padding: 15px 20px;
      margin-top: 20px;
      border-radius: 4px;
    }
    .incorrect {
      border-left-color: #cc0000;
      background: #f9d6d5;
    }
    .highlight-incorrect {
      color: #cc0000;
      font-weight: bold;
      margin-top: 8px;
    }
    .review-link {
      margin-top: 5px;
      font-size: 0.9rem;
    }
    .review-link a {
      color: #003366;
      text-decoration: underline;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>Annual Data Governance Quiz</h1>

<form id="quizForm">

  <div class="question" data-topic="Data Governance">
    <h3>1. What is the primary goal of data governance?</h3>
    <label><input type="radio" name="q1" value="a" /> To manage data assets by setting policies, roles, and responsibilities</label>
    <label><input type="radio" name="q1" value="b" /> To increase the amount of data collected</label>
    <label><input type="radio" name="q1" value="c" /> To store data for as long as possible</label>
  </div>

  <div class="question" data-topic="Data Quality">
    <h3>2. Which of the following are dimensions of data quality? (Select all that apply)</h3>
    <label><input type="checkbox" name="q2" value="accuracy" /> Accuracy</label>
    <label><input type="checkbox" name="q2" value="completeness" /> Completeness</label>
    <label><input type="checkbox" name="q2" value="popularity" /> Popularity</label>
    <label><input type="checkbox" name="q2" value="timeliness" /> Timeliness</label>
  </div>

  <div class="question" data-topic="Data Protection">
    <h3>3. Under PDPA, what must staff do if they suspect a data breach?</h3>
    <label><input type="radio" name="q3" value="a" /> Ignore it unless a supervisor notices</label>
    <label><input type="radio" name="q3" value="b" /> Report immediately to the Data Protection Officer</label>
    <label><input type="radio" name="q3" value="c" /> Post on social media to warn others</label>
  </div>

  <div class="question" data-topic="Data Access and Exploitation">
    <h3>4. What does "data fusion" mean in our context?</h3>
    <label><input type="radio" name="q4" value="a" /> Deleting duplicate data</label>
    <label><input type="radio" name="q4" value="b" /> Combining data from multiple sources responsibly to gain insights</label>
    <label><input type="radio" name="q4" value="c" /> Sharing data publicly</label>
  </div>

  <div class="question" data-topic="Key Staff Responsibilities">
    <h3>5. Which of the following are key responsibilities of staff? (Select all that apply)</h3>
    <label><input type="checkbox" name="q5" value="follow_procedures" /> Maintain data integrity by following procedures</label>
    <label><input type="checkbox" name="q5" value="use_personal_devices" /> Use personal devices for data tasks</label>
    <label><input type="checkbox" name="q5" value="report_incidents" /> Report data handling incidents promptly</label>
    <label><input type="checkbox" name="q5" value="participate_training" /> Participate in annual training and quizzes</label>
  </div>

  <!-- Add more questions up to 15 similarly -->

  <button type="button" id="submitBtn">Submit Quiz</button>
  <button type="button" id="retakeBtn" style="display:none;">Retake Quiz</button>
</form>

<div id="resultContainer"></div>

<script>
  const correctAnswers = {
    q1: ['a'],
    q2: ['accuracy', 'completeness', 'timeliness'],
    q3: ['b'],
    q4: ['b'],
    q5: ['follow_procedures', 'report_incidents', 'participate_training']
    // Extend with more questions as needed
  };

  const topicsLinks = {
    "Data Governance": "governance.html#DataGovernance",
    "Data Quality": "governance.html#DataQuality",
    "Data Protection": "governance.html#DataProtection",
    "Data Access and Exploitation": "governance.html#DataAccessAndExploitation",
    "Key Staff Responsibilities": "governance.html#KeyStaffResponsibilities"
  };

  const submitBtn = document.getElementById('submitBtn');
  const retakeBtn = document.getElementById('retakeBtn');
  const resultContainer = document.getElementById('resultContainer');
  const form = document.getElementById('quizForm');

  function getSelectedValues(name) {
    const inputs = form.querySelectorAll(`input[name="${name}"]`);
    let selected = [];
    inputs.forEach(input => {
      if (input.checked) selected.push(input.value);
    });
    return selected;
  }

  function arraysEqual(a, b) {
    if (a.length !== b.length) return false;
    let sortedA = a.slice().sort();
    let sortedB = b.slice().sort();
    return sortedA.every((v,i) => v === sortedB[i]);
  }

  submitBtn.addEventListener('click', () => {
    let totalQuestions = Object.keys(correctAnswers).length;
    let correctCount = 0;
    let incorrectQuestions = [];

    // Clear previous highlights
    document.querySelectorAll('.question').forEach(q => {
      q.classList.remove('incorrect');
      let highlight = q.querySelector('.highlight-incorrect');
      if (highlight) highlight.remove();
    });

    for (const [qName, correctVals] of Object.entries(correctAnswers)) {
      const userVals = getSelectedValues(qName);
      if (arraysEqual(userVals, correctVals)) {
        correctCount++;
      } else {
        incorrectQuestions.push(qName);
        const questionDiv = form.querySelector(`[name="${qName}"]`).closest('.question');
        questionDiv.classList.add('incorrect');
        // Add highlight
        let hint = document.createElement('div');
        hint.className = 'highlight-incorrect';
        hint.textContent = 'Incorrect answer. Please review this topic below.';
        questionDiv.appendChild(hint);

        // Add review link
        const topic = questionDiv.getAttribute('data-topic');
        if (topic && topicsLinks[topic]) {
          let reviewLink = document.createElement('div');
          reviewLink.className = 'review-link';
          reviewLink.innerHTML = `Review topic: <a href="${topicsLinks[topic]}" target="_blank">${topic}</a>`;
          questionDiv.appendChild(reviewLink);
        }
      }
    }

    const scorePercent = (correctCount / totalQuestions) * 100;

    resultContainer.innerHTML = `
      <div class="result ${scorePercent === 100 ? '' : 'incorrect'}">
        <h2>Your Score: ${correctCount} / ${totalQuestions} (${scorePercent.toFixed(0)}%)</h2>
        <p>${scorePercent === 100 ? 
          "Congratulations! You have passed the quiz." : 
          "You did not pass. Please review the topics linked below and try again."}</p>
      </div>
    `;

    if (scorePercent === 100) {
      submitBtn.style.display = 'none';
      retakeBtn.style.display = 'inline-block';
      // Optionally, here you could trigger certificate generation
    } else {
      // Scroll to first incorrect question
      if (incorrectQuestions.length > 0) {
        const firstIncorrectQ = form.querySelector('.incorrect');
        firstIncorrectQ.scrollIntoView({ behavior: 'smooth' });
      }
    }
  });

  retakeBtn.addEventListener('click', () => {
    // Reset form & UI for retake
    form.reset();
    submitBtn.style.display = 'inline-block';
    retakeBtn.style.display = 'none';
    resultContainer.innerHTML = '';
    document.querySelectorAll('.question').forEach(q => {
      q.classList.remove('incorrect');
      let highlight = q.querySelector('.highlight-incorrect');
      if (highlight) highlight.remove();
      let reviewLink = q.querySelector('.review-link');
      if (reviewLink) reviewLink.remove();
    });
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
</script>

</body>
</html>
